<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matschema Vecka 27-31</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            text-align: center;
            color: #4CAF50;
        }
        .week-selector {
            text-align: center;
            margin-bottom: 20px;
        }
        .week-selector select {
            width: 150px;
            padding: 5px;
        }
        table {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border-collapse: collapse;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        td:first-child {
            width: 20%;
        }
        td:nth-child(2), td:nth-child(3) {
            width: 40%;
        }
        .hidden {
            display: none;
        }
        select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
        }
        textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            box-sizing: border-box;
            resize: vertical;
        }
    </style>
    <script>
        function saveSelections() {
            const weeks = document.querySelectorAll('.week');
            weeks.forEach((week, weekIndex) => {
                const selects = week.querySelectorAll('select');
                const textareas = week.querySelectorAll('textarea');

                selects.forEach((select, selectIndex) => {
                    localStorage.setItem(`week${weekIndex}_select${selectIndex}`, select.value);
                });

                textareas.forEach((textarea, textareaIndex) => {
                    localStorage.setItem(`week${weekIndex}_textarea${textareaIndex}`, textarea.value);
                });
            });
        }

        function loadSelections() {
            const weeks = document.querySelectorAll('.week');
            weeks.forEach((week, weekIndex) => {
                const selects = week.querySelectorAll('select');
                const textareas = week.querySelectorAll('textarea');

                selects.forEach((select, selectIndex) => {
                    const savedValue = localStorage.getItem(`week${weekIndex}_select${selectIndex}`);
                    if (savedValue !== null) {
                        select.value = savedValue;
                    }
                });

                textareas.forEach((textarea, textareaIndex) => {
                    const savedValue = localStorage.getItem(`week${weekIndex}_textarea${textareaIndex}`);
                    if (savedValue !== null) {
                        textarea.value = savedValue;
                    }
                });
            });
        }

        function createICalEvent(title, date, startTime, endTime) {
            const icsFormat = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${title}
DTSTART:${date}T${startTime}
DTEND:${date}T${endTime}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsFormat], { type: 'text/calendar' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${title}.ics`;
            link.click();
        }

        function addICalButtons() {
            const weeks = [27, 28, 29, 30, 31];
            const days = ["Måndag", "Tisdag", "Onsdag", "Torsdag", "Fredag", "Lördag", "Söndag"];
            const lunchTime = { start: '113000', end: '123000' };
            const dinnerTime = { start: '173000', end: '183000' };

            weeks.forEach((week, weekIndex) => {
                days.forEach((day, dayIndex) => {
                    const date = new Date(2023, 6, (week - 27) * 7 + dayIndex + 3).toISOString().slice(0, 10).replace(/-/g, '');
                    const lunchSelect = document.querySelector(`#week-${week} .lunch-dropdown:nth-of-type(${dayIndex + 1})`);
                    const dinnerSelect = document.querySelector(`#week-${week} .dinner-dropdown:nth-of-type(${dayIndex + 1})`);

                    const lunchButton = document.createElement('button');
                    lunchButton.innerText = 'Lägg till i kalendern';
                    lunchButton.onclick = () => createICalEvent(lunchSelect.value, date, lunchTime.start, lunchTime.end);
                    lunchSelect.parentElement.appendChild(lunchButton);

                    const dinnerButton = document.createElement('button');
                    dinnerButton.innerText = 'Lägg till i kalendern';
                    dinnerButton.onclick = () => createICalEvent(dinnerSelect.value, date, dinnerTime.start, dinnerTime.end);
                    dinnerSelect.parentElement.appendChild(dinnerButton);
                });
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            const weeks = [27, 28, 29, 30, 31];
            const days = ["Måndag", "Tisdag", "Onsdag", "Torsdag", "Fredag", "Lördag", "Söndag"];
            const lunchOptions = [
                "Annat",
                "Smoothie och macka",
                "Pannkakor med sylt och grädde",
                "Sill och potatis",
                "Kräm och mjölk",
                "Grillad ostmacka",
                "Tomat- och mozzarellasallad",
                "Kall pastasallad med kyckling eller tonfisk",
                "Äggröra med bacon och toast",
                "Varmkorv med bröd",
                "Tunnbrödsrullar med skinka och sallad",
                "Kall potatissallad med lax",
                "Fruktsallad med yoghurt",
                "Grekisk sallad med fetaost och oliver",
                "Omelett med grönsaker",
                "Matiga muffins med ost och skinka"
            ];
            const dinnerOptions = [
                "Annat",
                "Pasta med köttfärssås",
                "Vegetarisk lasagne",
                "Spagetti carbonara",
                "Stuvade makaroner med falukorv",
                "Fiskpinnar med potatismos",
                "Grillad lax med citron och dill",
                "Ugnsbakad torsk/lax med citron- och dillsås",
                "Rödbetsbiffar med fetaost och sallad",
                "Grönsaksgryta med kokosmjölk",
                "Bakad potatis",
                "Fläskpannkaka",
                "Korv stroganoff",
                "Flygande Jakob",
                "Tacos",
                "Grillade hamburgare",
                "Köttbullar med potatismos och lingonsylt",
                "Pytt i panna",
                "Pizza"
            ];

            function createTable(week) {
                let table = `<div id="week-${week}" class="week hidden">
                    <h2>Vecka ${week}</h2>
                    <table>
                        <tr>
                            <th>Dag</th>
                            <th>Lunch</th>
                            <th>Middag</th>
                        </tr>`;

                days.forEach(day => {
                    table += `<tr>
                        <td>${day}</td>
                        <td>
                            <select class="lunch-dropdown" onchange="saveSelections()"></select>
                            <textarea placeholder="Kommentarer" oninput="saveSelections()"></textarea>
                        </td>
                        <td>
                            <select class="dinner-dropdown" onchange="saveSelections()"></select>
                            <textarea placeholder="Kommentarer" oninput="saveSelections()"></textarea>
                        </td>
                    </tr>`;
                });

                table += `</table></div>`;
                return table;
            }

            function populateDropdowns() {
                document.querySelectorAll('.lunch-dropdown').forEach(dropdown => {
                    lunchOptions.forEach(option => {
                        let opt = document.createElement('option');
                        opt.value = option;
                        opt.innerHTML = option;
                        dropdown.appendChild(opt);
                    });
                });

                document.querySelectorAll('.dinner-dropdown').forEach(dropdown => {
                    dinnerOptions.forEach(option => {
                        let opt = document.createElement('option');
                        opt.value = option;
                        opt.innerHTML = option;
                        dropdown.appendChild(opt);
                    });
                });
            }

            function showWeek(week) {
                document.querySelectorAll('.week').forEach(weekTable => {
                    weekTable.classList.add('hidden');
                });
                document.getElementById(`week-${week}`).classList.remove('hidden');
            }

            weeks.forEach(week => {
                document.body.insertAdjacentHTML('beforeend', createTable(week));
            });

            document.getElementById('week').addEventListener('change', function() {
                showWeek(this.value);
            });

            populateDropdowns();
            addICalButtons();
            loadSelections();
            showWeek(27);
        });
    </script>
</head>
<body>
    <h1>Matschema för semestern</h1>

    <div class="week-selector">
        <label for="week">Välj vecka:</label>
        <select id="week">
            <option value="27">Vecka 27</option>
            <option value="28">Vecka 28</option>
            <option value="29">Vecka 29</option>
            <option value="30">Vecka 30</option>
            <option value="31">Vecka 31</option>
        </select>
    </div>
</body>
</html>
